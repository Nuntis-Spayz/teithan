function GUITeithan(){let _t=this;_t.version="0.0.2",_t.date="2022-05-03",_t.log=console.log,this.f=String.fromCharCode,this.alloptions="",_t.keyStrBase64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_t.keyStrUriSafe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",_t.baseReverseDic={},_t.settings=[],_t.init=()=>{$("document").ready((function(){_t.refresh(),setTimeout((function(){_t.refresh()}),5e3),$("body").on("input","div[teithaneditable]",_t.change),$("body").on("input","textarea[teithan]",_t.tachange),$("body").on("keyup click","div[teithaneditable]",_t.editevent),$("body").on("mousedown","span[teithanmenu] span",_t.menuMouseDown)}))},_t.refresh=()=>{var alloptions=" ";$("textarea[teithan]").each((function(){alloptions+=$(this).data("options")+" "})),_t.alloptions=alloptions,_t.alloptions.includes(" no-css ")||0!=$("style[teithan]").length||$("body").prepend("<style type='text/css' teithan>\n          [teithaneditable]{border:2px solid black;border-radius:1em;padding:0.5em;overflow:auto;position:relative;z-index:20;}\n          [teithanheader]{}\n          [teithanmenu]{border:2px solid silver;border-radius:0.5em;background:white;float:right;z-index:2;}\n          [teithanmenu] span{font-family:serif;cursor:default;margin:2px 0px 2px 0.25em;border:1px solid silver;border-radius:0.3em;padding:2px 4px;background-color:lightgray;color:black;min-width:1.25em;display:inline-block;text-align:center;}\n          [teithanmenu] span.btnoff{background-color:#eee;}\n          [teithanmenu] span.btnon{background-color:lime;}\n          [teithanmenu] span:hover{background-color:darkgray;color:white;}\n          </style>"),$("textarea[teithan]").each((function(idx){_t.log(idx+": "+$(this).text());var tid=$(this).attr("teithan");if(_t.log("tid",tid),""==tid){var tid=_t.randomString(24);$(this).attr("teithan",tid);var options=" "+$(this).data("options").toLowerCase()+" ";_t.log("options",options),options.includes(" show-raw ")||$(this).css("display","none");var mcss=$(this).data("menu-style"),lcss=$(this).data("label-style"),css=$(this).data("style"),label=$(this).data("label"),btns="";options.includes(" std ")?options+=" h1 h2 h3 b i u ul ol ":options.includes(" min ")&&(options+=" h1 b i u "),_t.log("btn options",options),btns=(options.includes(" h1 ")?"<span>H1</span>":"")+(options.includes(" h2 ")?"<span>H2</span>":"")+(options.includes(" h3 ")?"<span>H3</span>":"")+(options.includes(" h4 ")?"<span>H4</span>":"")+(options.includes(" h5 ")?"<span>H5</span>":"")+(options.includes(" h6 ")?"<span>H6</span>":"")+(options.includes(" b ")?"<span>B</span>":"")+(options.includes(" i ")?"<span><i>I</i></span>":"")+(options.includes(" u ")?"<span style='text-decoration:underline;'>U</span>":"")+(options.includes(" ul ")?"<span data-tag='ul'>&vellip;</span>":"")+(options.includes(" ol ")?"<span data-tag='ol'>&sup1;&sup2;&sup3;</span>":"")+(options.includes(" btn-raw ")?"<span data-tag='raw' class='"+(options.includes(" show-raw ")?"btnon":"btnoff")+"'>&lt;&bull;&gt;</span>":""),_t.log("btns",btns),$(this).before(`<div teithanheader='${tid}' charset="utf-8">&nbsp;`+(""==btns?"":`<span teithanmenu='${tid}' style='user-select:none;${mcss}'>`+(options.includes(" no-menu-name ")?"":"&apid; Menu ")+`${btns}</span>`)+(options.includes(" no-info ")?"":`<span teithaninfo='${tid}' style='${lcss}'>Teithan GUI HTML Editor v.${_t.version} ${_t.date}</span>`)+"<br style='clear:both'></div>"),!options.includes(" no-info ")&&label&&(options.includes(" no-label-delay ")?$(`[teithaninfo=${tid}]`).html(label):setTimeout((function(tid,t){$(`[teithaninfo=${tid}]`).fadeOut(500,(function(){$(this).html(t)})).fadeIn()}),750,tid,label)),$(this).before(`<div teithaneditable='${tid}' style='${css}' contenteditable charset="utf-8">`+$(this).text()+"</div>")}}))},_t.randomString=(slength=0)=>{var chars="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZ0123456789abcdefghiklmnopqrstuvwxyz".split("");slength||(slength=Math.floor(Math.random()*chars.length)),_t.log(slength);for(var str="";str.length<slength;)str+=chars[Math.floor(Math.random()*chars.length)];return str},_t.change=e=>{var tid=$(e.target).attr("teithaneditable");$(`textarea[teithan=${tid}]`).val($(e.target).html()),_t.log("change:",tid),_t.log("change64:",_t.compressToBase64(tid)),_t.log("change64undo:",_t.decompressFromBase64(_t.compressToBase64(tid))),_t.saveRangePosition(tid)},_t.tachange=e=>{var tid=$(e.target).attr("teithan");_t.log("tachange:",tid),$(`div[teithaneditable=${tid}]`).html($(e.target).val())},_t.editevent=e=>{_t.log("edit evnt:",e),_t.saveRangePosition($(e.target).attr("teithaneditable"))},_t.menuMouseDown=e=>{e.stopImmediatePropagation(),e.preventDefault(),_t.log("btn m-down");var btn=$(e.target).data("tag")||$(e.target).text();btn=btn.toLowerCase(),_t.log("btn click:",btn),($(e.target).hasClass("btnon")||$(e.target).hasClass("btnoff"))&&($(e.target).toggleClass("btnon"),$(e.target).toggleClass("btnoff"));var tid=$(e.target).parent().attr("teithanmenu");switch(_t.log("btn menu tid:",tid),_t.restoreRangePosition(tid),btn){case"raw":$(e.target).hasClass("btnon")?$(`textarea[teithan=${tid}]`).css("display","block"):$(`textarea[teithan=${tid}]`).css("display","none");break;case"b":document.execCommand("bold",!1);break;case"i":document.execCommand("italic",!1);break;case"u":document.execCommand("underline",!1);break;case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":if(!document.execCommand("heading",!1,btn.toUpperCase())){document.getSelection().collapseToStart();var st=document.getSelection().anchorOffset,ln=document.getSelection().anchorNode.parentElement.localName.toLowerCase(),pE=document.getSelection().anchorNode.parentElement;_t.log("localName",ln),ln==btn?pE.outerHTML="<p>"+pE.innerHTML+"</p>":("p"==ln||ln.startsWith("h"))&&(pE.outerHTML=`<${btn}>`+pE.innerHTML+`</${btn}>`)}break;case"ul":document.execCommand("insertUnorderedList",!1);break;case"ol":document.execCommand("insertOrderedList",!1)}},_t.saveRangePosition=tid=>{_t.log("save to",typeof tid),thEditor=$(`div[teithaneditable=${tid}]`).first(),thEditor.focus(),_t.log("saveRangePosition:",tid)},_t.restoreRangePosition=tid=>{thEditor=$(`div[teithaneditable=${tid}]`).first(),thEditor.focus(),_t.log("restoreRangePosition:",tid)},_t.compressToBase64=input=>{if(null==input)return"";var res=_t._compress(input,6,(function(a){return _t.keyStrBase64.charAt(a)}));switch(res.length%4){default:case 0:return res;case 1:return res+"===";case 2:return res+"==";case 3:return res+"="}},_t.decompressFromBase64=input=>null==input?"":""==input?null:_t._decompress(input.length,32,(function(index){return _t.getBaseValue(_t.keyStrBase64,input.charAt(index))})),_t.getBaseValue=(alphabet,character)=>{if(!_t.baseReverseDic[alphabet]){_t.baseReverseDic[alphabet]={};for(var i=0;i<alphabet.length;i++)_t.baseReverseDic[alphabet][alphabet.charAt(i)]=i}return _t.baseReverseDic[alphabet][character]},_t._compress=(uncompressed,bitsPerChar,getCharFromInt)=>{if(null==uncompressed)return"";var i,value,context_dictionary={},context_dictionaryToCreate={},context_c="",context_wc="",context_w="",context_enlargeIn=2,context_dictSize=3,context_numBits=2,context_data=[],context_data_val=0,context_data_position=0,ii;for(ii=0;ii<uncompressed.length;ii+=1)if(context_c=uncompressed.charAt(ii),Object.prototype.hasOwnProperty.call(context_dictionary,context_c)||(context_dictionary[context_c]=context_dictSize++,context_dictionaryToCreate[context_c]=!0),context_wc=context_w+context_c,Object.prototype.hasOwnProperty.call(context_dictionary,context_wc))context_w=context_wc;else{if(Object.prototype.hasOwnProperty.call(context_dictionaryToCreate,context_w)){if(context_w.charCodeAt(0)<256){for(i=0;i<context_numBits;i++)context_data_val<<=1,context_data_position==bitsPerChar-1?(context_data_position=0,context_data.push(getCharFromInt(context_data_val)),context_data_val=0):context_data_position++;for(value=context_w.charCodeAt(0),i=0;i<8;i++)context_data_val=context_data_val<<1|1&value,context_data_position==bitsPerChar-1?(context_data_position=0,context_data.push(getCharFromInt(context_data_val)),context_data_val=0):context_data_position++,value>>=1}else{for(value=1,i=0;i<context_numBits;i++)context_data_val=context_data_val<<1|value,context_data_position==bitsPerChar-1?(context_data_position=0,context_data.push(getCharFromInt(context_data_val)),context_data_val=0):context_data_position++,value=0;for(value=context_w.charCodeAt(0),i=0;i<16;i++)context_data_val=context_data_val<<1|1&value,context_data_position==bitsPerChar-1?(context_data_position=0,context_data.push(getCharFromInt(context_data_val)),context_data_val=0):context_data_position++,value>>=1}0==--context_enlargeIn&&(context_enlargeIn=Math.pow(2,context_numBits),context_numBits++),delete context_dictionaryToCreate[context_w]}else for(value=context_dictionary[context_w],i=0;i<context_numBits;i++)context_data_val=context_data_val<<1|1&value,context_data_position==bitsPerChar-1?(context_data_position=0,context_data.push(getCharFromInt(context_data_val)),context_data_val=0):context_data_position++,value>>=1;0==--context_enlargeIn&&(context_enlargeIn=Math.pow(2,context_numBits),context_numBits++),context_dictionary[context_wc]=context_dictSize++,context_w=String(context_c)}if(""!==context_w){if(Object.prototype.hasOwnProperty.call(context_dictionaryToCreate,context_w)){if(context_w.charCodeAt(0)<256){for(i=0;i<context_numBits;i++)context_data_val<<=1,context_data_position==bitsPerChar-1?(context_data_position=0,context_data.push(getCharFromInt(context_data_val)),context_data_val=0):context_data_position++;for(value=context_w.charCodeAt(0),i=0;i<8;i++)context_data_val=context_data_val<<1|1&value,context_data_position==bitsPerChar-1?(context_data_position=0,context_data.push(getCharFromInt(context_data_val)),context_data_val=0):context_data_position++,value>>=1}else{for(value=1,i=0;i<context_numBits;i++)context_data_val=context_data_val<<1|value,context_data_position==bitsPerChar-1?(context_data_position=0,context_data.push(getCharFromInt(context_data_val)),context_data_val=0):context_data_position++,value=0;for(value=context_w.charCodeAt(0),i=0;i<16;i++)context_data_val=context_data_val<<1|1&value,context_data_position==bitsPerChar-1?(context_data_position=0,context_data.push(getCharFromInt(context_data_val)),context_data_val=0):context_data_position++,value>>=1}0==--context_enlargeIn&&(context_enlargeIn=Math.pow(2,context_numBits),context_numBits++),delete context_dictionaryToCreate[context_w]}else for(value=context_dictionary[context_w],i=0;i<context_numBits;i++)context_data_val=context_data_val<<1|1&value,context_data_position==bitsPerChar-1?(context_data_position=0,context_data.push(getCharFromInt(context_data_val)),context_data_val=0):context_data_position++,value>>=1;0==--context_enlargeIn&&(context_enlargeIn=Math.pow(2,context_numBits),context_numBits++)}for(value=2,i=0;i<context_numBits;i++)context_data_val=context_data_val<<1|1&value,context_data_position==bitsPerChar-1?(context_data_position=0,context_data.push(getCharFromInt(context_data_val)),context_data_val=0):context_data_position++,value>>=1;for(;;){if(context_data_val<<=1,context_data_position==bitsPerChar-1){context_data.push(getCharFromInt(context_data_val));break}context_data_position++}return context_data.join("")},_t.decompress=compressed=>null==compressed?"":""==compressed?null:_t._decompress(compressed.length,32768,(function(index){return compressed.charCodeAt(index)})),_t._decompress=(length,resetValue,getNextValue)=>{var dictionary=[],next,enlargeIn=4,dictSize=4,numBits=3,entry="",result=[],i,w,bits,resb,maxpower,power,c,data={val:getNextValue(0),position:resetValue,index:1};for(i=0;i<3;i+=1)dictionary[i]=i;for(bits=0,maxpower=Math.pow(2,2),power=1;power!=maxpower;)resb=data.val&data.position,data.position>>=1,0==data.position&&(data.position=resetValue,data.val=getNextValue(data.index++)),bits|=(resb>0?1:0)*power,power<<=1;switch(next=bits){case 0:for(bits=0,maxpower=Math.pow(2,8),power=1;power!=maxpower;)resb=data.val&data.position,data.position>>=1,0==data.position&&(data.position=resetValue,data.val=getNextValue(data.index++)),bits|=(resb>0?1:0)*power,power<<=1;c=_t.f(bits);break;case 1:for(bits=0,maxpower=Math.pow(2,16),power=1;power!=maxpower;)resb=data.val&data.position,data.position>>=1,0==data.position&&(data.position=resetValue,data.val=getNextValue(data.index++)),bits|=(resb>0?1:0)*power,power<<=1;c=_t.f(bits);break;case 2:return""}for(dictionary[3]=c,w=c,result.push(c);;){if(data.index>length)return"";for(bits=0,maxpower=Math.pow(2,numBits),power=1;power!=maxpower;)resb=data.val&data.position,data.position>>=1,0==data.position&&(data.position=resetValue,data.val=getNextValue(data.index++)),bits|=(resb>0?1:0)*power,power<<=1;switch(c=bits){case 0:for(bits=0,maxpower=Math.pow(2,8),power=1;power!=maxpower;)resb=data.val&data.position,data.position>>=1,0==data.position&&(data.position=resetValue,data.val=getNextValue(data.index++)),bits|=(resb>0?1:0)*power,power<<=1;dictionary[dictSize++]=_t.f(bits),c=dictSize-1,enlargeIn--;break;case 1:for(bits=0,maxpower=Math.pow(2,16),power=1;power!=maxpower;)resb=data.val&data.position,data.position>>=1,0==data.position&&(data.position=resetValue,data.val=getNextValue(data.index++)),bits|=(resb>0?1:0)*power,power<<=1;dictionary[dictSize++]=_t.f(bits),c=dictSize-1,enlargeIn--;break;case 2:return result.join("")}if(0==enlargeIn&&(enlargeIn=Math.pow(2,numBits),numBits++),dictionary[c])entry=dictionary[c];else{if(c!==dictSize)return null;entry=w+w.charAt(0)}result.push(entry),dictionary[dictSize++]=w+entry.charAt(0),w=entry,0==--enlargeIn&&(enlargeIn=Math.pow(2,numBits),numBits++)}}}teithan=new GUITeithan,teithan.init();